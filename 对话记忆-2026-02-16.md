# GPU-Insight 项目对话记忆

## 📅 对话信息

**日期**：2026-02-16
**时长**：约 2 小时
**主题**：基于 auto-company 和 everything-claude-code 设计 GPU-Insight 架构
**GitHub 仓库**：https://github.com/JeromeZhou/VibeDev
**最新提交**：819e059

---

## 🎯 项目背景

### 原始需求（APPrequest.txt）

**项目名称**：显卡用户痛点智能分析系统（GPU-Insight）

**核心功能**：
1. 每 4 小时自动抓取 7 个显卡论坛（Chiphell, NGA, 百度贴吧, ROG, Twitter, Guru3D, Reddit）
2. AI 深度分析：生成摘要 + 提取痛点 + 推导隐藏需求
3. PPHI 指数排名（加权算法）
4. 防 AI 幻觉机制（多智能体交叉验证）
5. 生成可视化报告

**参考项目**：
- nicepkg/auto-company（自治智能体协作模式）
- affaan-m/everything-claude-code（项目结构最佳实践）

---

## 💡 关键设计决策

### 决策 1：两套 Agents 团队

**问题**：用户提出"Agents team 关闭也不影响项目运作"

**解决方案**：混合架构设计
- **模式 A（Agent Teams 开启）**：并行抓取 7 个论坛，Expert Council 多视角验证
- **模式 B（Agent Teams 关闭）**：串行抓取，单 Agent 模拟多角色

**实现**：
- 增加 `src/` 目录（独立 Python 脚本）
- 增加 `main.py`（自动检测并切换模式）
- 增加 `config/agent_teams.yaml`（配置开关）

---

### 决策 2：增加 UI/UX 设计师

**问题**：用户发现"开发团队里面没有美工 UX 设计，我的痛点展示页面需要"

**解决方案**：增加第 6 个开发 Agent
- **UI Designer Agent**（Matías Duarte 思维模型）
- 负责痛点仪表盘、趋势分析页、详情页设计
- 建立完整的 Material Design 设计系统

**交付物**：
- 设计规范文档（颜色、字体、组件）
- 前端代码示例（`前端示例-Dashboard.html`）
- 4 个页面设计（Dashboard, Trends, Detail, Admin）

---

### 决策 3：防幻觉机制

**三层验证架构**：
1. **推理链强制可视化**：Hidden Need Inferencer 必须输出完整推理过程
2. **Devil's Advocate 质疑**：Munger 对所有高置信度结论进行反向论证
3. **历史数据交叉验证**：Chief Analyst 用过去 4 周数据验证

---

## 🏗️ 最终架构

### Agents 团队（14 个）

#### 开发阶段（6 个）
1. **Architect**（Werner Vogels）- 系统架构设计
2. **Fullstack**（DHH）- 代码实现
3. **Data Engineer** - 数据管道
4. **UI Designer**（Matías Duarte）- 界面设计 ⭐ 新增
5. **QA**（James Bach）- 测试
6. **DevOps**（Kelsey Hightower）- 部署运维

#### 生产阶段（8 个）
1. **Orchestrator** - 总指挥
2. **Scraper Master**（Kelsey Hightower）- 数据采集
3. **Data Curator** - 数据清洗
4. **Pain Extractor** - 痛点提取
5. **Hidden Need Inferencer** - 隐藏需求推导
6. **Expert Council**（3 个 Persona）- 多视角验证
   - Hardware Engineer
   - Product Manager
   - Data Scientist
7. **PPHI Ranker** - 排名计算
8. **Cost Controller**（Patrick Campbell）- 成本控制

---

### 项目结构

```
GPU-Insight/
├── .claude/
│   ├── CLAUDE.md                    # 项目章程
│   ├── settings.json                # Agent Teams 开关
│   ├── agents/
│   │   ├── dev/                     # 6个开发 Agents
│   │   └── prod/                    # 8个生产 Agents
│   └── skills/                      # 可复用技能
│
├── src/                             # 独立代码（不依赖Agent Teams）
│   ├── scrapers/                    # 爬虫脚本
│   ├── cleaners/                    # 数据清洗
│   ├── analyzers/                   # 分析模块
│   ├── rankers/                     # PPHI算法
│   ├── reporters/                   # 报告生成
│   └── web/                         # Web界面 ⭐ 新增
│       ├── app.py
│       ├── static/
│       └── templates/
│
├── config/
│   ├── config.yaml
│   ├── agent_teams.yaml             # Agent Teams配置 ⭐ 新增
│   └── ui_design.yaml               # UI设计规范 ⭐ 新增
│
├── memories/
│   └── consensus.md                 # 共识记忆（接力棒）
│
├── data/
│   ├── raw/                         # 原始语料（永久保留）
│   ├── processed/
│   └── archive/
│
├── main.py                          # 主入口（支持两种模式）
└── auto-loop.sh                     # 4小时自动循环
```

---

## 💰 成本评估

### 单周期（4 小时）Token 消耗
- Orchestrator: 2,500 tokens
- Scraper: 0 tokens（纯代码）
- Cleaner: 38,000 tokens
- Analyst: 200,000 tokens ⭐ 主要消耗
- Insight: 300,000 tokens ⭐ 主要消耗
- Council: 100,000 tokens
- Ranker: 0 tokens（纯算法）
- Reporter: 9,000 tokens

**总计**：约 450,000 tokens/周期（优化后）

### 月度成本（180 个周期）

| 模型策略 | 月度成本 |
|---------|---------|
| 全用 Claude 3.5 Sonnet | $388 |
| 全用 GPT-4o-mini | $19.4 |
| **混合架构（推荐）** | **$65-80** |

**混合策略**：
- 数据清洗 + 痛点提取：GPT-4o-mini
- 隐藏需求推导 + Munger 质疑：Claude 3.5 Sonnet
- PPHI 计算：本地脚本

---

## 📚 交付文档（8 个文件，95KB）

| 文件名 | 大小 | 说明 |
|--------|------|------|
| GPU-Insight-架构设计.md | 15KB | 完整架构设计 v1 |
| GPU-Insight-架构更新-v2.md | 12KB | 支持 Agent Teams 开关 + UI 设计师 |
| Agent示例-首席分析师.md | 12KB | Ben Thompson 思维模型示例 |
| UI-Designer-Agent-完整定义.md | 14KB | Matías Duarte 思维模型 |
| CLAUDE.md示例.md | 13KB | 项目章程模板 |
| consensus.md示例.md | 9KB | 共识记忆模板 |
| 前端示例-Dashboard.html | 8KB | 可直接运行的前端代码 |
| 讨论总结-GPU-Insight.md | 12KB | 完整讨论回顾 |

---

## 🎨 UI 设计亮点

### 设计系统
- **风格**：Material Design
- **颜色**：蓝色主色调 + 红橙绿表达强度
- **字体**：Noto Sans SC（中文）+ Roboto（英文）
- **组件**：卡片、统计卡、趋势图

### 页面设计
1. **痛点仪表盘**：Top 10 排名 + 统计卡 + 趋势图
2. **趋势分析页**：折线图 + 堆叠柱状图 + 词云
3. **痛点详情页**：摘要 + 推理链 + 原始讨论 + Expert 评审
4. **数据源监控**：抓取状态 + 质量评分 + 成本监控

### 技术栈
- 前端：HTML + Tailwind CSS + Chart.js
- 后端：FastAPI（Python）
- 部署：Cloudflare Workers

---

## 🔑 关键技术点

### 1. 借鉴 auto-company 的设计

**真实专家人格驱动**：
- 不是"你是一个分析师"，而是"你是 Ben Thompson"
- 每个 Agent 基于真实专家的思维模型

**共识记忆传递**：
- `consensus.md` 是跨周期的"接力棒"
- 每轮读取 → 执行 → 更新 → 传递

**自治循环**：
- `auto-loop.sh` 每 4 小时自动触发
- 无需人工干预，完全自主运行

**防幻觉机制**：
- Munger 式的逆向思考
- 强制输出推理过程
- 历史数据交叉验证

---

### 2. 借鉴 everything-claude-code 的结构

**目录组织**：
- `.claude/agents/` - Agent 定义
- `.claude/skills/` - 可复用技能
- `.claude/hooks/` - 自动化钩子
- `.claude/rules/` - 业务规则

**Agent 定义格式**：
```markdown
---
name: agent-name
description: "简短描述"
model: inherit
---

# Agent Name

## Role
角色定位

## Persona
人格设定

## Core Principles
核心原则

## Output Format
输出格式
```

---

### 3. 混合架构设计

**核心原则**：关键路径不依赖 Agent Teams

```python
# 自动检测并切换模式
if agent_teams_available():
    run_with_agent_teams()  # 并行执行
else:
    run_without_agent_teams()  # 串行执行
```

**优势**：
- Agent Teams 开启：享受并行优势
- Agent Teams 关闭：仍可正常工作
- 一个配置项即可切换

---

## 📊 实施路线图

### Phase 1：单源 MVP（1 周）
- 搭建基础目录结构
- 创建 3 个核心 Agent
- 仅接入 Chiphell 论坛
- 验证"隐藏需求推导"可行性
- **验收标准**：痛点提取准确率 > 80%

### Phase 2：多源集成（2 周）
- 创建全部 8 个 Agent
- 接入全部 7 个论坛
- 部署 4h 循环
- **验收标准**：PPHI 排名符合直觉

### Phase 3：优化与监控（1 周）
- 成本优化
- 异常检测
- 报告生成
- **验收标准**：月成本 < $80

---

## 🔧 待实施的技术细节

### 1. 爬虫实现
- Playwright（动态渲染）
- 代理池轮换
- Cookie 管理
- 增量抓取（last_post_id）

### 2. 数据清洗
- SimHash 去重
- 多语言术语对齐
- 繁简转换（OpenCC）

### 3. PPHI 算法
```python
PPHI = (频率权重 × 提及次数) +
       (来源权重 × 来源质量分) +
       (互动权重 × 互动热度) -
       (时间衰减 × 天数)
```

### 4. 前端部署
- FastAPI 后端
- Jinja2 模板
- Chart.js 可视化
- Cloudflare Workers 部署

---

## ⚠️ 风险与应对

| 风险 | 应对策略 |
|------|---------|
| 法律风险（论坛 ToS 禁止爬虫） | 优先使用官方 API，降低频率 |
| 数据偏差（中英文社区差异） | 分层分析，分别计算 PPHI |
| 成本失控（长篇帖子 Token 超预期） | 设置单条输入上限 2000 tokens |
| AI 幻觉（过度推导） | 三层验证 + Munger 质疑 |
| 反爬封禁 | 代理池 + 失败自动切换 |

---

## 📌 下一步行动

### 立即可做
1. ✅ 查看前端效果：打开 `前端示例-Dashboard.html`
2. ⏳ 启用 Agent Teams（可选）
3. ⏳ 创建基础目录结构
4. ⏳ 开始 Phase 1 MVP

### 需要决策
1. Agent Teams 是否启用？
2. 前端部署方式？
3. 预算确认（$100/$200/$400）？
4. 数据源选择（7 个还是先 3-4 个）？

---

## 🔗 相关链接

- **GitHub 仓库**：https://github.com/JeromeZhou/VibeDev
- **参考项目 1**：https://github.com/nicepkg/auto-company
- **参考项目 2**：https://github.com/affaan-m/everything-claude-code
- **Claude Code 文档**：https://docs.anthropic.com/en/docs/claude-code

---

## 💭 讨论中的关键问题

### Q1: "我希望 Agents team 关闭也不影响项目的运作，是否有这个能力？"

**A**: 完全可以！设计了混合架构：
- 核心功能（爬虫、清洗、分析）用独立 Python 脚本实现
- Agent Teams 只是"锦上添花"（并行加速、多视角验证）
- 关闭后自动降级为串行模式，仍可正常工作

---

### Q2: "开发团队里面没有美工 UX 设计，我的痛点展示页面需要"

**A**: 已增加 UI Designer Agent（Matías Duarte 思维模型）：
- 完整的 Material Design 设计系统
- 4 个页面设计（Dashboard, Trends, Detail, Admin）
- 可直接运行的前端代码示例
- 响应式布局 + 可访问性支持

---

## 📝 总结

### 完成的工作
1. ✅ 深入研究了 auto-company 和 everything-claude-code
2. ✅ 设计了 14 个 Agent（6 开发 + 8 生产）
3. ✅ 设计了混合架构（支持 Agent Teams 开关）
4. ✅ 完成了详细的成本评估（月度 $65-80）
5. ✅ 设计了完整的 UI/UX（含前端代码）
6. ✅ 创建了 8 个核心文档（95KB）
7. ✅ 制定了 3 阶段实施路线图
8. ✅ 同步到 GitHub

### 核心价值
- **真正的自治**：每个 Agent 有独立决策能力
- **防幻觉机制**：三层验证确保质量
- **成本可控**：混合模型 + 预算告警
- **灵活部署**：Agent Teams 可开可关
- **完整设计**：从架构到前端全覆盖

---

**项目状态**：架构设计完成，等待实施 ✅

**GitHub 提交**：819e059

**下次对话重点**：Phase 1 MVP 实施
