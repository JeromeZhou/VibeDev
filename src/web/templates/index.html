<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU-Insight ç—›ç‚¹ä»ªè¡¨ç›˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; background: #080c1a; color: #e2e8f0; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .card {
            background: rgba(15,23,42,0.85);
            backdrop-filter: blur(16px);
            border-radius: 14px;
            border: 1px solid rgba(56,78,122,0.35);
            box-shadow: 0 2px 8px rgba(0,0,0,0.4), 0 8px 32px rgba(0,0,0,0.2);
            transition: all 0.25s ease;
        }
        .card:hover { transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.5), 0 12px 40px rgba(0,0,0,0.25); }
        .gpu-tag { background: rgba(67,56,202,0.35); color: #a5b4fc; padding: 3px 10px; border-radius: 6px; font-size: 12px; font-weight: 500; border: 1px solid rgba(99,102,241,0.25); }
        .mfr-tag { background: rgba(6,95,70,0.4); color: #6ee7b7; padding: 3px 10px; border-radius: 6px; font-size: 12px; font-weight: 500; border: 1px solid rgba(16,185,129,0.25); }
        .brand-tag { background: rgba(154,52,18,0.35); color: #fdba74; padding: 3px 10px; border-radius: 6px; font-size: 12px; font-weight: 500; border: 1px solid rgba(249,115,22,0.25); }
        .stat-card { position: relative; overflow: hidden; }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            border-radius: 14px 14px 0 0;
        }
        .stat-1 { border-color: rgba(59,130,246,0.3); }
        .stat-1::before { background: linear-gradient(90deg, #2563eb, #3b82f6, #60a5fa); }
        .stat-2 { border-color: rgba(99,102,241,0.3); }
        .stat-2::before { background: linear-gradient(90deg, #4f46e5, #6366f1, #818cf8); }
        .stat-3 { border-color: rgba(139,92,246,0.3); }
        .stat-3::before { background: linear-gradient(90deg, #7c3aed, #8b5cf6, #a78bfa); }
        .stat-4 { border-color: rgba(16,185,129,0.3); }
        .stat-4::before { background: linear-gradient(90deg, #059669, #10b981, #34d399); }

        .pphi-ring {
            width: 58px; height: 58px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            position: relative;
        }
        .pphi-ring::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            border: 3px solid rgba(51,65,85,0.5);
        }

        .top-item { position: relative; }
        .top-1 { border-left: 3px solid #f59e0b; background: linear-gradient(90deg, rgba(245,158,11,0.08), transparent 60%); }
        .top-2 { border-left: 3px solid #94a3b8; background: linear-gradient(90deg, rgba(148,163,184,0.06), transparent 60%); }
        .top-3 { border-left: 3px solid #cd7c2f; background: linear-gradient(90deg, rgba(205,124,47,0.06), transparent 60%); }
        .top-1 .pphi-ring {
            background: radial-gradient(circle, rgba(245,158,11,0.2), transparent);
            box-shadow: 0 0 20px rgba(245,158,11,0.15), 0 0 40px rgba(245,158,11,0.05);
        }
        .top-1 .pphi-ring::before { border-color: rgba(245,158,11,0.5); }
        .top-2 .pphi-ring {
            background: radial-gradient(circle, rgba(148,163,184,0.15), transparent);
            box-shadow: 0 0 16px rgba(148,163,184,0.1);
        }
        .top-2 .pphi-ring::before { border-color: rgba(148,163,184,0.4); }
        .top-3 .pphi-ring {
            background: radial-gradient(circle, rgba(205,124,47,0.15), transparent);
            box-shadow: 0 0 16px rgba(205,124,47,0.1);
        }
        .top-3 .pphi-ring::before { border-color: rgba(205,124,47,0.4); }

        /* Default PPHI ring glow for rank 4+ */
        .top-item:not(.top-1):not(.top-2):not(.top-3) .pphi-ring {
            background: radial-gradient(circle, rgba(59,130,246,0.1), transparent);
            box-shadow: 0 0 12px rgba(59,130,246,0.08);
        }
        .top-item:not(.top-1):not(.top-2):not(.top-3) .pphi-ring::before { border-color: rgba(59,130,246,0.35); }

        .glow-blue { box-shadow: 0 0 30px rgba(59,130,246,0.08), 0 4px 20px rgba(0,0,0,0.3); }
        .trend-up { color: #34d399; }
        .trend-down { color: #f87171; }
        .trend-new { color: #60a5fa; }
        .trend-stable { color: #94a3b8; }

        .need-badge {
            background: linear-gradient(135deg, rgba(99,102,241,0.18), rgba(139,92,246,0.18));
            border: 1px solid rgba(139,92,246,0.35);
            border-radius: 8px;
            padding: 4px 10px;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in { animation: fadeInUp 0.4s ease forwards; opacity: 0; }
        .delay-1 { animation-delay: 0.05s; }
        .delay-2 { animation-delay: 0.1s; }
        .delay-3 { animation-delay: 0.15s; }
        .delay-4 { animation-delay: 0.2s; }

        .mesh-bg {
            background:
                radial-gradient(ellipse at 15% 50%, rgba(37,99,235,0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 85% 15%, rgba(124,58,237,0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 85%, rgba(5,150,105,0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 60% 40%, rgba(59,130,246,0.04) 0%, transparent 60%);
        }

        /* Rank medal badges */
        .rank-medal {
            width: 28px; height: 28px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 700;
        }
        .medal-gold { background: linear-gradient(135deg, #f59e0b, #d97706); color: #451a03; box-shadow: 0 0 10px rgba(245,158,11,0.3); }
        .medal-silver { background: linear-gradient(135deg, #cbd5e1, #94a3b8); color: #1e293b; box-shadow: 0 0 8px rgba(148,163,184,0.2); }
        .medal-bronze { background: linear-gradient(135deg, #cd7c2f, #a3631a); color: #1c1917; box-shadow: 0 0 8px rgba(205,124,47,0.2); }

        /* Expand button */
        .expand-btn {
            background: linear-gradient(135deg, rgba(59,130,246,0.12), rgba(99,102,241,0.12));
            border: 1px solid rgba(59,130,246,0.3);
            transition: all 0.25s ease;
        }
        .expand-btn:hover {
            background: linear-gradient(135deg, rgba(59,130,246,0.2), rgba(99,102,241,0.2));
            border-color: rgba(59,130,246,0.5);
        }

        /* Hidden items */
        .ranking-extra { display: none; }
        .ranking-extra.show { display: block; }

        /* About modal */
        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            z-index: 50;
            display: none;
            align-items: center; justify-content: center;
        }
        .modal-overlay.active { display: flex; }
        .modal-content {
            background: rgba(15,23,42,0.95);
            border: 1px solid rgba(56,78,122,0.4);
            border-radius: 16px;
            max-width: 480px; width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body class="min-h-screen mesh-bg">
    <header class="py-6 px-6 border-b border-slate-700/40">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div>
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-500/20">
                        <span class="material-icons text-white text-lg">insights</span>
                    </div>
                    <h1 class="text-2xl font-bold text-white tracking-tight">GPU-Insight</h1>
                </div>
                <p class="text-slate-400 text-sm mt-1 ml-12">æ˜¾å¡ç”¨æˆ·ç—›ç‚¹æ™ºèƒ½åˆ†æ Â· {{ updated_at }}</p>
            </div>
            <div class="flex gap-4 items-center">
                <a href="/trends" class="text-slate-400 hover:text-white text-sm flex items-center gap-1 transition">
                    <span class="material-icons text-base">trending_up</span> è¶‹åŠ¿
                </a>
                <button onclick="document.getElementById('aboutModal').classList.add('active')"
                        class="text-slate-400 hover:text-white text-sm flex items-center gap-1 transition">
                    <span class="material-icons text-base">info_outline</span> å…³äº
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto py-6 px-4">
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="card stat-card stat-1 p-5 animate-in delay-1">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons text-blue-400 text-lg">bug_report</span>
                    <p class="text-slate-400 text-xs font-medium uppercase tracking-wider">æœ¬è½®ç—›ç‚¹</p>
                </div>
                <p class="text-3xl font-bold text-white mono">{{ data.total_pain_points }}</p>
            </div>
            <div class="card stat-card stat-2 p-5 animate-in delay-2">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons text-indigo-400 text-lg">replay</span>
                    <p class="text-slate-400 text-xs font-medium uppercase tracking-wider">åˆ†æè½®æ¬¡</p>
                </div>
                <p class="text-3xl font-bold text-white mono">{{ stats.total_runs }}</p>
            </div>
            <div class="card stat-card stat-3 p-5 animate-in delay-3">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons text-purple-400 text-lg">psychology</span>
                    <p class="text-slate-400 text-xs font-medium uppercase tracking-wider">ç´¯è®¡ç—›ç‚¹</p>
                </div>
                <p class="text-3xl font-bold text-white mono">{{ stats.total_pains }}</p>
            </div>
            <div class="card stat-card stat-4 p-5 animate-in delay-4">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons text-emerald-400 text-lg">memory</span>
                    <p class="text-slate-400 text-xs font-medium uppercase tracking-wider">GPU å‹å·</p>
                </div>
                <p class="text-3xl font-bold text-white mono">
                    {% set ns2 = namespace(models=[]) %}
                    {% for r in rankings %}
                        {% for m in r.get('gpu_tags', {}).get('models', []) %}
                            {% if m not in ns2.models %}{% set ns2.models = ns2.models + [m] %}{% endif %}
                        {% endfor %}
                    {% endfor %}
                    {{ ns2.models | length }}
                </p>
            </div>
        </div>

        <!-- Top ç—›ç‚¹æ’å -->
        <div class="card p-6 glow-blue">
            <div class="flex items-center justify-between mb-5">
                <h2 class="text-lg font-bold text-white flex items-center gap-2">
                    <span class="material-icons text-blue-400">leaderboard</span>
                    ç—›ç‚¹æ’å
                </h2>
                <span class="text-xs text-slate-400 mono">PPHI Index Â· å…± {{ rankings | length }} é¡¹</span>
            </div>
            {% if rankings %}
            <div class="space-y-3" id="rankingList">
                {% for r in rankings %}
                <a href="/pain-point/{{ r.rank }}"
                   class="block p-4 rounded-xl top-item
                          {% if r.rank == 1 %}top-1{% elif r.rank == 2 %}top-2{% elif r.rank == 3 %}top-3{% else %}border-l-3 border-transparent bg-slate-800/20{% endif %}
                          hover:bg-slate-700/40 transition-all duration-200
                          {% if r.rank > 10 %}ranking-extra{% endif %}"
                   style="animation: fadeInUp 0.4s ease forwards; animation-delay: {{ r.rank * 0.04 }}s; opacity: 0;">
                    <div class="flex items-center gap-4">
                        <!-- Rank + PPHI Ring -->
                        <div class="pphi-ring shrink-0">
                            <div class="text-center">
                                <p class="text-xl font-bold mono
                                    {% if r.rank == 1 %}text-amber-400{% elif r.rank == 2 %}text-slate-300{% elif r.rank == 3 %}text-amber-600{% else %}text-blue-400{% endif %}">
                                    {{ r.pphi_score }}
                                </p>
                            </div>
                        </div>

                        <!-- Content -->
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                {% if r.rank <= 3 %}
                                <span class="rank-medal {% if r.rank == 1 %}medal-gold{% elif r.rank == 2 %}medal-silver{% else %}medal-bronze{% endif %}">{{ r.rank }}</span>
                                {% else %}
                                <span class="text-xs font-bold mono text-slate-400">#{{ r.rank }}</span>
                                {% endif %}
                                {% if r.get('trend') == 'rising' %}<span class="trend-up text-xs font-bold">â†‘</span>
                                {% elif r.get('trend') == 'falling' %}<span class="trend-down text-xs font-bold">â†“</span>
                                {% elif r.get('trend') == 'stable' %}<span class="trend-stable text-xs">â†’</span>
                                {% else %}<span class="trend-new text-xs font-bold">â˜…</span>{% endif %}
                                <h3 class="font-semibold text-white truncate">{{ r.pain_point }}</h3>
                            </div>

                            <!-- Tags -->
                            <div class="flex flex-wrap gap-1.5 mb-1.5">
                                {% for b in r.get('gpu_tags', {}).get('brands', [])[:2] %}
                                <span class="brand-tag">{{ b }}</span>
                                {% endfor %}
                                {% for m in r.get('gpu_tags', {}).get('models', [])[:4] %}
                                <span class="gpu-tag">{{ m }}</span>
                                {% endfor %}
                                {% for mfr in r.get('gpu_tags', {}).get('manufacturers', [])[:3] %}
                                <span class="mfr-tag">{{ mfr }}</span>
                                {% endfor %}
                            </div>

                            <div class="flex items-center gap-3 text-xs text-slate-400">
                                <span>{{ r.get('mentions', 0) }} è®¨è®º</span>
                                <span>Â·</span>
                                <span>{{ r.get('sources', []) | join(' / ') }}</span>
                                <span>Â·</span>
                                <span>{{ r.get('category', '') }}</span>
                                {% if r.get('affected_users') %}
                                <span>Â·</span>
                                <span>{{ r.get('affected_users', '') }}</span>
                                {% endif %}
                            </div>

                            {% if r.get('hidden_need') %}
                            <div class="need-badge mt-2 inline-block">
                                <span class="text-xs text-indigo-300">ğŸ’¡ {{ r.hidden_need }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>

            {% if rankings | length > 10 %}
            <button id="expandBtn" onclick="toggleExpand()"
                    class="expand-btn w-full mt-4 py-3 rounded-xl text-sm text-blue-400 font-medium flex items-center justify-center gap-2 cursor-pointer">
                <span class="material-icons text-base" id="expandIcon">expand_more</span>
                <span id="expandText">æŸ¥çœ‹å…¨éƒ¨ {{ rankings | length }} ä¸ªç—›ç‚¹</span>
            </button>
            {% endif %}

            {% else %}
            <div class="text-center py-12">
                <span class="material-icons text-4xl text-slate-500 mb-2">hourglass_empty</span>
                <p class="text-slate-400">ç­‰å¾…é¦–æ¬¡æ•°æ®é‡‡é›†...</p>
            </div>
            {% endif %}
        </div>
    </main>

    <footer class="text-center text-slate-500 text-xs py-6 border-t border-slate-800/30 mt-8">
        GPU-Insight v1.0 Â· æ˜¾å¡ç”¨æˆ·ç—›ç‚¹æ™ºèƒ½åˆ†æç³»ç»Ÿ
    </footer>

    <!-- About Modal -->
    <div id="aboutModal" class="modal-overlay" onclick="if(event.target===this)this.classList.remove('active')">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-white flex items-center gap-2">
                    <span class="material-icons text-blue-400">info</span> å…³äº GPU-Insight
                </h3>
                <button onclick="document.getElementById('aboutModal').classList.remove('active')"
                        class="text-slate-400 hover:text-white transition">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="space-y-3 text-sm text-slate-300 leading-relaxed">
                <p>GPU-Insight æ˜¯ä¸€ä¸ªæ˜¾å¡ç”¨æˆ·ç—›ç‚¹æ™ºèƒ½åˆ†æç³»ç»Ÿï¼Œæ¯ 4 å°æ—¶è‡ªåŠ¨é‡‡é›†å…¨çƒæ˜¾å¡è®ºå›è®¨è®ºï¼Œé€šè¿‡ AI æå–ç—›ç‚¹å¹¶æ¨å¯¼éšè—éœ€æ±‚ã€‚</p>
                <div class="p-3 bg-slate-800/50 rounded-lg border border-slate-700/40">
                    <p class="text-xs text-slate-400 mb-1">æ ¸å¿ƒæŒ‡æ ‡</p>
                    <p class="text-white font-medium">PPHI (Pain Point Heat Index) â€” ç—›ç‚¹çƒ­åº¦æŒ‡æ•°</p>
                    <p class="text-slate-400 text-xs mt-1">ç»¼åˆè®¨è®ºé‡ã€æƒ…æ„Ÿå¼ºåº¦ã€ä¼ æ’­èŒƒå›´ç­‰ç»´åº¦åŠ æƒè®¡ç®—</p>
                </div>
                <div class="flex flex-wrap gap-2 text-xs">
                    <span class="px-2 py-1 bg-slate-800/50 rounded text-slate-400 border border-slate-700/30">æ•°æ®æº: Reddit / NGA / è´´å§</span>
                    <span class="px-2 py-1 bg-slate-800/50 rounded text-slate-400 border border-slate-700/30">AI: SiliconFlow GLM</span>
                    <span class="px-2 py-1 bg-slate-800/50 rounded text-slate-400 border border-slate-700/30">æ›´æ–°: æ¯ 4 å°æ—¶</span>
                </div>
            </div>
        </div>
    </div>

    <script>
    function toggleExpand() {
        const extras = document.querySelectorAll('.ranking-extra');
        const btn = document.getElementById('expandBtn');
        const icon = document.getElementById('expandIcon');
        const text = document.getElementById('expandText');
        const isExpanded = extras[0]?.classList.contains('show');

        extras.forEach((el, i) => {
            if (isExpanded) {
                el.classList.remove('show');
            } else {
                el.classList.add('show');
                el.style.animation = `fadeInUp 0.3s ease forwards`;
                el.style.animationDelay = `${i * 0.03}s`;
            }
        });

        if (isExpanded) {
            icon.textContent = 'expand_more';
            text.textContent = 'æŸ¥çœ‹å…¨éƒ¨ {{ rankings | length }} ä¸ªç—›ç‚¹';
        } else {
            icon.textContent = 'expand_less';
            text.textContent = 'æ”¶èµ·åˆ—è¡¨';
        }
    }
    </script>
</body>
</html>
