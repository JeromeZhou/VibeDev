<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU-Insight ç—›ç‚¹ä»ªè¡¨ç›˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Noto+Sans+SC:wght@400;500;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-base:     #0b0d14;
            --bg-surface:  #111318;
            --bg-elevated: #161922;
            --bg-hover:    #1c1f2b;
            --border-subtle:  rgba(255,255,255,0.06);
            --border-default: rgba(255,255,255,0.09);
            --border-strong:  rgba(255,255,255,0.14);
            --text-primary:   #ececf1;
            --text-secondary: #8b8fa3;
            --text-tertiary:  #565869;
            --accent-blue:    #5b8def;
            --accent-purple:  #9d8abf;
            --accent-green:   #5ec49e;
            --accent-red:     #e5534b;
            --accent-amber:   #d4a04a;
            --accent-silver:  #9ba3b0;
            --accent-bronze:  #b08952;
        }

        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background: var(--bg-base);
            color: var(--text-primary);
            font-weight: 400;
        }
        .mono { font-family: 'JetBrains Mono', monospace; }

        .card {
            background: var(--bg-surface);
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transition: border-color 0.2s ease;
        }
        .card:hover { border-color: var(--border-default); }

        .gpu-tag {
            background: rgba(139,92,246,0.10);
            color: #a78bcc;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid rgba(139,92,246,0.15);
        }
        .mfr-tag {
            background: rgba(80,200,150,0.08);
            color: #7bc4a5;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid rgba(80,200,150,0.12);
        }
        .brand-tag {
            background: rgba(220,150,60,0.08);
            color: #c4a06b;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid rgba(220,150,60,0.12);
        }

        /* Stat cards â€” left 2px color bar instead of top 4px */
        .stat-card { position: relative; overflow: hidden; }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; bottom: 0;
            width: 2px;
            border-radius: 12px 0 0 12px;
        }
        .stat-1::before { background: var(--accent-blue); }
        .stat-2::before { background: var(--accent-purple); }
        .stat-3::before { background: #8b5cf6; }
        .stat-4::before { background: var(--accent-green); }

        /* PPHI ring â€” 44px, no glow, plain */
        .pphi-ring {
            width: 44px; height: 44px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid var(--border-strong);
            background: transparent;
        }

        .top-item {
            position: relative;
            border-radius: 8px;
            border: 1px solid transparent;
            transition: border-color 0.2s ease, background-color 0.2s ease;
        }
        .top-item:hover {
            background: var(--bg-hover);
            border-color: var(--border-default);
        }

        /* Top 1/2/3 â€” left 2px bar, low-saturation colors, no glow */
        .top-1 { border-left: 2px solid var(--accent-amber); }
        .top-1 .pphi-ring { border-color: var(--accent-amber); }
        .top-2 { border-left: 2px solid var(--accent-silver); }
        .top-2 .pphi-ring { border-color: var(--accent-silver); }
        .top-3 { border-left: 2px solid var(--accent-bronze); }
        .top-3 .pphi-ring { border-color: var(--accent-bronze); }

        .rank-medal {
            width: 24px; height: 24px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: 600;
        }
        .medal-gold   { background: var(--accent-amber); color: #1a1400; }
        .medal-silver { background: var(--accent-silver); color: #111318; }
        .medal-bronze { background: var(--accent-bronze); color: #1a1400; }

        .trend-up     { color: var(--accent-green); }
        .trend-down   { color: var(--accent-red); }
        .trend-new    { color: var(--accent-blue); }
        .trend-stable { color: var(--text-tertiary); }

        .need-badge {
            background: rgba(139,92,246,0.08);
            border: 1px solid rgba(139,92,246,0.15);
            border-radius: 6px;
            padding: 4px 8px;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in { animation: fadeInUp 0.3s ease forwards; opacity: 0; }
        .delay-1 { animation-delay: 0.05s; }
        .delay-2 { animation-delay: 0.1s; }
        .delay-3 { animation-delay: 0.15s; }
        .delay-4 { animation-delay: 0.2s; }

        .mesh-bg {
            background:
                radial-gradient(ellipse at 15% 50%, rgba(37,99,235,0.04) 0%, transparent 50%),
                radial-gradient(ellipse at 85% 15%, rgba(124,58,237,0.03) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 85%, rgba(5,150,105,0.03) 0%, transparent 50%);
        }

        .expand-btn {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            transition: border-color 0.2s ease;
        }
        .expand-btn:hover { border-color: var(--border-default); }

        .ranking-extra { display: none; }
        .ranking-extra.show { display: block; }

        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 50;
            display: none;
            align-items: center; justify-content: center;
        }
        .modal-overlay.active { display: flex; }
        .modal-content {
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: 12px;
            max-width: 480px; width: 90%;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        /* PPHI tooltip */
        .pphi-tooltip {
            position: relative;
            cursor: help;
        }
        .pphi-tooltip .pphi-tip-text {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            top: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 400;
            color: var(--text-secondary);
            white-space: nowrap;
            z-index: 10;
            transition: opacity 0.15s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .pphi-tooltip:hover .pphi-tip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Nav link */
        .nav-link {
            color: var(--text-secondary);
            font-size: 14px;
            display: flex; align-items: center; gap: 4px;
            transition: color 0.15s ease;
        }
        .nav-link:hover { color: var(--text-primary); }
    </style>
</head>
<body class="min-h-screen mesh-bg">
    <header class="py-4 px-6 border-b" style="border-color: var(--border-subtle);">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background: var(--accent-blue);">
                    <span class="material-icons text-white text-base">insights</span>
                </div>
                <div>
                    <h1 class="text-lg font-semibold" style="color: var(--text-primary);">GPU-Insight</h1>
                    <p class="text-xs" style="color: var(--text-tertiary);">æ˜¾å¡ç”¨æˆ·ç—›ç‚¹æ™ºèƒ½åˆ†æ Â· {{ updated_at }}</p>
                </div>
            </div>
            <div class="flex gap-4 items-center">
                <a href="/trends" class="nav-link">
                    <span class="material-icons text-base">trending_up</span> è¶‹åŠ¿
                </a>
                <a href="/history" class="nav-link">
                    <span class="material-icons text-base">history</span> å†å²
                </a>
                <button onclick="document.getElementById('aboutModal').classList.add('active')" class="nav-link">
                    <span class="material-icons text-base">info_outline</span> å…³äº
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto py-6 px-4">
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="card stat-card stat-1 p-4 animate-in delay-1">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons text-base" style="color: var(--accent-blue);">bug_report</span>
                    <p class="text-xs font-medium uppercase tracking-wider" style="color: var(--text-tertiary);">Top ç—›ç‚¹</p>
                </div>
                <p class="text-2xl font-semibold mono" style="color: var(--text-primary);">{{ data.total_pain_points }}</p>
            </div>
            <div class="card stat-card stat-2 p-4 animate-in delay-2">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons text-base" style="color: var(--accent-purple);">replay</span>
                    <p class="text-xs font-medium uppercase tracking-wider" style="color: var(--text-tertiary);">åˆ†æè½®æ¬¡</p>
                </div>
                <p class="text-2xl font-semibold mono" style="color: var(--text-primary);">{{ stats.total_runs }}</p>
            </div>
            <div class="card stat-card stat-3 p-4 animate-in delay-3">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons text-base" style="color: #8b5cf6;">psychology</span>
                    <p class="text-xs font-medium uppercase tracking-wider" style="color: var(--text-tertiary);">ç´¯è®¡ç—›ç‚¹</p>
                </div>
                <p class="text-2xl font-semibold mono" style="color: var(--text-primary);">{{ stats.total_pains }}</p>
            </div>
            <div class="card stat-card stat-4 p-4 animate-in delay-4">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons text-base" style="color: var(--accent-green);">memory</span>
                    <p class="text-xs font-medium uppercase tracking-wider" style="color: var(--text-tertiary);">GPU å‹å·</p>
                </div>
                <p class="text-2xl font-semibold mono" style="color: var(--text-primary);">
                    {% set ns2 = namespace(models=[]) %}
                    {% for r in rankings %}
                        {% for m in r.get('gpu_tags', {}).get('models', []) %}
                            {% if m not in ns2.models %}{% set ns2.models = ns2.models + [m] %}{% endif %}
                        {% endfor %}
                    {% endfor %}
                    {{ ns2.models | length }}
                </p>
            </div>
        </div>

        <!-- Top ç—›ç‚¹æ’å -->
        <div class="card p-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-base font-semibold flex items-center gap-2" style="color: var(--text-primary);">
                    <span class="material-icons" style="color: var(--accent-blue);">leaderboard</span>
                    ç—›ç‚¹æ’å
                    <span class="pphi-tooltip">
                        <span class="material-icons text-sm" style="color: var(--text-tertiary);">help_outline</span>
                        <span class="pphi-tip-text">PPHI = Pain Point Heat Indexï¼Œç»¼åˆè®¨è®ºé‡ã€æƒ…æ„Ÿå¼ºåº¦ã€ä¼ æ’­èŒƒå›´åŠ æƒè®¡ç®—</span>
                    </span>
                </h2>
                <span class="text-xs mono" style="color: var(--text-tertiary);">PPHI Index Â· å…± {{ rankings | length }} é¡¹</span>
            </div>
            {% if rankings %}
            <div class="space-y-2" id="rankingList">
                {% for r in rankings %}
                <a href="/pain-point/{{ r.rank }}"
                   class="block p-3 top-item
                          {% if r.rank == 1 %}top-1{% elif r.rank == 2 %}top-2{% elif r.rank == 3 %}top-3{% endif %}
                          {% if r.rank > 10 %}ranking-extra{% endif %}"
                   style="animation: fadeInUp 0.3s ease forwards; animation-delay: {{ r.rank * 0.03 }}s; opacity: 0;">
                    <div class="flex items-center gap-3">
                        <!-- PPHI Ring -->
                        <div class="pphi-ring shrink-0">
                            <span class="text-sm font-semibold mono
                                {% if r.rank == 1 %}" style="color: var(--accent-amber);
                                {% elif r.rank == 2 %}" style="color: var(--accent-silver);
                                {% elif r.rank == 3 %}" style="color: var(--accent-bronze);
                                {% else %}" style="color: var(--accent-blue);{% endif %}">
                                {{ r.pphi_score }}
                            </span>
                        </div>

                        <!-- Content -->
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                {% if r.rank <= 3 %}
                                <span class="rank-medal {% if r.rank == 1 %}medal-gold{% elif r.rank == 2 %}medal-silver{% else %}medal-bronze{% endif %}">{{ r.rank }}</span>
                                {% else %}
                                <span class="text-xs font-semibold mono" style="color: var(--text-tertiary);">#{{ r.rank }}</span>
                                {% endif %}
                                {% if r.get('trend') == 'rising' %}<span class="trend-up text-xs font-semibold">â†‘</span>
                                {% elif r.get('trend') == 'falling' %}<span class="trend-down text-xs font-semibold">â†“</span>
                                {% elif r.get('trend') == 'stable' %}<span class="trend-stable text-xs">â†’</span>
                                {% else %}<span class="trend-new text-xs font-semibold">â˜…</span>{% endif %}
                                <h3 class="font-medium text-sm truncate" style="color: var(--text-primary);">{{ r.pain_point }}</h3>
                            </div>

                            <!-- Tags -->
                            <div class="flex flex-wrap gap-1 mb-1">
                                {% for b in r.get('gpu_tags', {}).get('brands', [])[:2] %}
                                <span class="brand-tag">{{ b }}</span>
                                {% endfor %}
                                {% for m in r.get('gpu_tags', {}).get('models', [])[:4] %}
                                <span class="gpu-tag">{{ m }}</span>
                                {% endfor %}
                                {% for mfr in r.get('gpu_tags', {}).get('manufacturers', [])[:3] %}
                                <span class="mfr-tag">{{ mfr }}</span>
                                {% endfor %}
                            </div>

                            <div class="flex items-center gap-2 text-xs" style="color: var(--text-tertiary);">
                                <span>{{ r.get('mentions', 0) }} è®¨è®º</span>
                                <span>Â·</span>
                                <span>{{ r.get('sources', []) | join(' / ') }}</span>
                                <span>Â·</span>
                                <span>{{ r.get('category', '') }}</span>
                                {% if r.get('affected_users') %}
                                <span>Â·</span>
                                <span>{{ r.get('affected_users', '') }}</span>
                                {% endif %}
                            </div>

                            {% if r.get('hidden_need') %}
                            <div class="need-badge mt-2 inline-block">
                                <span class="text-xs" style="color: var(--accent-purple);">ğŸ’¡ {{ r.hidden_need }}</span>
                            </div>
                            {% endif %}
                        </div>

                        <!-- Chevron -->
                        <span class="material-icons shrink-0" style="color: var(--text-tertiary); font-size: 20px;">chevron_right</span>
                    </div>
                </a>
                {% endfor %}
            </div>

            {% if rankings | length > 10 %}
            <button id="expandBtn" onclick="toggleExpand()"
                    class="expand-btn w-full mt-4 py-3 rounded-lg text-sm font-medium flex items-center justify-center gap-2 cursor-pointer"
                    style="color: var(--accent-blue);">
                <span class="material-icons text-base" id="expandIcon">expand_more</span>
                <span id="expandText">æŸ¥çœ‹å…¨éƒ¨ {{ rankings | length }} ä¸ªç—›ç‚¹</span>
            </button>
            {% endif %}

            {% else %}
            <div class="text-center py-12">
                <span class="material-icons text-4xl mb-2" style="color: var(--text-tertiary);">hourglass_empty</span>
                <p style="color: var(--text-secondary);">ç­‰å¾…é¦–æ¬¡æ•°æ®é‡‡é›†...</p>
            </div>
            {% endif %}
        </div>
    </main>

    <footer class="text-center text-xs py-6 mt-8" style="color: var(--text-tertiary); border-top: 1px solid var(--border-subtle);">
        GPU-Insight v1.0 Â· æ˜¾å¡ç”¨æˆ·ç—›ç‚¹æ™ºèƒ½åˆ†æç³»ç»Ÿ
    </footer>

    <!-- About Modal -->
    <div id="aboutModal" class="modal-overlay" onclick="if(event.target===this)this.classList.remove('active')">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-base font-semibold flex items-center gap-2" style="color: var(--text-primary);">
                    <span class="material-icons" style="color: var(--accent-blue);">info</span> å…³äº GPU-Insight
                </h3>
                <button onclick="document.getElementById('aboutModal').classList.remove('active')"
                        class="nav-link">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="space-y-3 text-sm leading-relaxed" style="color: var(--text-secondary);">
                <p>GPU-Insight æ˜¯ä¸€ä¸ªæ˜¾å¡ç”¨æˆ·ç—›ç‚¹æ™ºèƒ½åˆ†æç³»ç»Ÿï¼Œæ¯ 4 å°æ—¶è‡ªåŠ¨é‡‡é›†å…¨çƒæ˜¾å¡è®ºå›è®¨è®ºï¼Œé€šè¿‡ AI æå–ç—›ç‚¹å¹¶æ¨å¯¼éšè—éœ€æ±‚ã€‚</p>
                <div class="p-3 rounded-lg" style="background: var(--bg-elevated); border: 1px solid var(--border-subtle);">
                    <p class="text-xs mb-1" style="color: var(--text-tertiary);">æ ¸å¿ƒæŒ‡æ ‡</p>
                    <p class="font-medium" style="color: var(--text-primary);">PPHI (Pain Point Heat Index) â€” ç—›ç‚¹çƒ­åº¦æŒ‡æ•°</p>
                    <p class="text-xs mt-1" style="color: var(--text-tertiary);">ç»¼åˆè®¨è®ºé‡ã€æƒ…æ„Ÿå¼ºåº¦ã€ä¼ æ’­èŒƒå›´ç­‰ç»´åº¦åŠ æƒè®¡ç®—</p>
                </div>
                <div class="flex flex-wrap gap-2 text-xs">
                    <span class="px-2 py-1 rounded" style="background: var(--bg-elevated); color: var(--text-tertiary); border: 1px solid var(--border-subtle);">æ•°æ®æº: Reddit / NGA / è´´å§</span>
                    <span class="px-2 py-1 rounded" style="background: var(--bg-elevated); color: var(--text-tertiary); border: 1px solid var(--border-subtle);">AI: SiliconFlow GLM</span>
                    <span class="px-2 py-1 rounded" style="background: var(--bg-elevated); color: var(--text-tertiary); border: 1px solid var(--border-subtle);">æ›´æ–°: æ¯ 4 å°æ—¶</span>
                </div>
            </div>
        </div>
    </div>

    <script>
    function toggleExpand() {
        const extras = document.querySelectorAll('.ranking-extra');
        const btn = document.getElementById('expandBtn');
        const icon = document.getElementById('expandIcon');
        const text = document.getElementById('expandText');
        const isExpanded = extras[0]?.classList.contains('show');

        extras.forEach((el, i) => {
            if (isExpanded) {
                el.classList.remove('show');
            } else {
                el.classList.add('show');
                el.style.animation = `fadeInUp 0.3s ease forwards`;
                el.style.animationDelay = `${i * 0.03}s`;
            }
        });

        if (isExpanded) {
            icon.textContent = 'expand_more';
            text.textContent = 'æŸ¥çœ‹å…¨éƒ¨ {{ rankings | length }} ä¸ªç—›ç‚¹';
        } else {
            icon.textContent = 'expand_less';
            text.textContent = 'æ”¶èµ·åˆ—è¡¨';
        }
    }
    </script>
</body>
</html>
