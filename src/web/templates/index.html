<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU-Insight ç—›ç‚¹ä»ªè¡¨ç›˜</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Noto+Sans+SC:wght@400;500;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link href="/static/base.css" rel="stylesheet">
    <style>
        /* ç»Ÿè®¡å¡ç‰‡å·¦è‰²æ¡ */
        .stat-card { position: relative; overflow: hidden; }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; bottom: 0;
            width: 2px;
            border-radius: 12px 0 0 12px;
        }
        .stat-1::before { background: var(--accent-blue); }
        .stat-2::before { background: var(--accent-green); }
        .stat-3::before { background: var(--accent-purple); }
        .stat-4::before { background: var(--accent-amber); }

        /* æ’åé¡¹ */
        .top-item {
            position: relative;
            border-radius: 8px;
            border: 1px solid transparent;
            transition: border-color 0.2s, background-color 0.2s;
        }
        .top-item:hover {
            background: var(--bg-hover);
            border-color: var(--border-default);
        }
        .top-1 { border-left: 2px solid var(--accent-amber); }
        .top-1 .pphi-ring { border-color: var(--accent-amber); }
        .top-2 { border-left: 2px solid var(--accent-silver); }
        .top-2 .pphi-ring { border-color: var(--accent-silver); }
        .top-3 { border-left: 2px solid var(--accent-bronze); }
        .top-3 .pphi-ring { border-color: var(--accent-bronze); }

        .need-badge {
            background: rgba(139,92,246,0.08);
            border: 1px solid rgba(139,92,246,0.15);
            border-radius: 6px;
            padding: 4px 8px;
        }

        .expand-btn {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            transition: border-color 0.2s;
        }
        .expand-btn:hover { border-color: var(--border-default); }

        .ranking-extra { display: none; }
        .ranking-extra.show { display: block; }

        /* PPHI tooltip */
        .pphi-tooltip { position: relative; cursor: help; }
        .pphi-tooltip .pphi-tip-text {
            visibility: hidden; opacity: 0;
            position: absolute; top: calc(100% + 8px); left: 50%;
            transform: translateX(-50%);
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 12px; font-weight: 400;
            color: var(--text-secondary);
            white-space: nowrap; z-index: 10;
            transition: opacity 0.15s;
        }
        .pphi-tooltip:hover .pphi-tip-text { visibility: visible; opacity: 1; }

        /* å…³äºå¼¹çª— */
        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 50;
            display: none;
            align-items: center; justify-content: center;
        }
        .modal-overlay.active { display: flex; }
        .modal-content {
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: 12px;
            max-width: 480px; width: 90%;
        }
    </style>
</head>
<body class="mesh-bg">
    <!-- å¯¼èˆª -->
    <nav class="site-nav">
        <span class="nav-brand"><span class="material-icons">insights</span> GPU-Insight</span>
        <a href="/" class="active"><span class="material-icons">dashboard</span> ä»ªè¡¨ç›˜</a>
        <a href="/trends"><span class="material-icons">trending_up</span> è¶‹åŠ¿</a>
        <a href="/history"><span class="material-icons">history</span> å†å²</a>
        <a href="/report"><span class="material-icons">description</span> æŠ¥å‘Š</a>
        <a href="/admin"><span class="material-icons">admin_panel_settings</span> ç®¡ç†</a>
        <a href="javascript:void(0)" onclick="document.getElementById('aboutModal').classList.add('active')"><span class="material-icons">info_outline</span> å…³äº</a>
    </nav>

    <div class="page-container">
        <!-- æ›´æ–°æ—¶é—´ -->
        <div class="flex items-center justify-between mb-4" style="margin-top: 4px;">
            <div></div>
            <span class="text-xs" style="color: var(--text-tertiary);">{{ updated_at }}</span>
        </div>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="grid grid-4 gap-4 mb-6">
            <div class="card stat-card stat-1 p-4 animate-in delay-1">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons text-base" style="color: var(--accent-blue);">bug_report</span>
                    <span class="text-xs font-medium" style="color: var(--text-tertiary);">å½“å‰ç—›ç‚¹</span>
                </div>
                <span class="text-2xl font-semibold mono">{{ data.total_pain_points }}</span>
            </div>
            <div class="card stat-card stat-2 p-4 animate-in delay-2">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons text-base" style="color: var(--accent-green);">article</span>
                    <span class="text-xs font-medium" style="color: var(--text-tertiary);">ç´¯è®¡å¸–å­</span>
                </div>
                <span class="text-2xl font-semibold mono">{{ stats.total_posts }}</span>
            </div>
            <div class="card stat-card stat-3 p-4 animate-in delay-3">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons text-base" style="color: var(--accent-purple);">replay</span>
                    <span class="text-xs font-medium" style="color: var(--text-tertiary);">åˆ†æè½®æ¬¡</span>
                </div>
                <span class="text-2xl font-semibold mono">{{ stats.total_runs }}</span>
            </div>
            <div class="card stat-card stat-4 p-4 animate-in delay-4">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons text-base" style="color: var(--accent-amber);">language</span>
                    <span class="text-xs font-medium" style="color: var(--text-tertiary);">æ•°æ®æº</span>
                </div>
                <span class="text-2xl font-semibold mono">{{ stats.total_sources }}</span>
            </div>
        </div>

        {% if delta.new_pains > 0 or delta.new_models > 0 %}
        <div class="flex items-center gap-3 mb-4 px-1 text-xs" style="color: var(--text-tertiary);">
            <span class="material-icons" style="font-size: 14px; color: var(--accent-green);">trending_up</span>
            <span>æœ¬è½®å˜åŒ–ï¼š</span>
            {% if delta.new_pains > 0 %}
            <span style="color: var(--accent-green);">+{{ delta.new_pains }} æ–°ç—›ç‚¹</span>
            {% endif %}
            {% if delta.new_models > 0 %}
            <span style="color: var(--accent-blue);">+{{ delta.new_models }} æ–°å‹å·</span>
            {% endif %}
        </div>
        {% endif %}

        <!-- ç—›ç‚¹æ’å -->
        <div class="card p-5">
            <div class="flex items-center justify-between mb-4">
                <div class="section-title" style="margin-bottom: 0;">
                    <span class="material-icons" style="color: var(--accent-blue);">leaderboard</span>
                    ç—›ç‚¹æ’å
                    <span class="pphi-tooltip">
                        <span class="material-icons" style="font-size: 14px; color: var(--text-tertiary);">help_outline</span>
                        <span class="pphi-tip-text">PPHI = Pain Point Heat Indexï¼Œç»¼åˆè®¨è®ºé‡ã€æƒ…æ„Ÿå¼ºåº¦ã€ä¼ æ’­èŒƒå›´åŠ æƒè®¡ç®—</span>
                    </span>
                </div>
                <span class="text-xs mono" style="color: var(--text-tertiary);">PPHI Index Â· å…± {{ rankings | length }} é¡¹</span>
            </div>

            {% if rankings %}
            <div class="space-y-2" id="rankingList">
                {% for r in rankings %}
                <a href="/pain-point/{{ r.rank }}"
                   class="block p-3 top-item
                          {% if r.rank == 1 %}top-1{% elif r.rank == 2 %}top-2{% elif r.rank == 3 %}top-3{% endif %}
                          {% if r.rank > 10 %}ranking-extra{% endif %}"
                   style="animation: fadeInUp 0.3s ease forwards; animation-delay: {{ r.rank * 0.03 }}s; opacity: 0;">
                    <div class="flex items-center gap-3">
                        <div class="pphi-ring">
                            <span class="text-sm font-semibold mono"
                                style="color: {% if r.rank == 1 %}var(--accent-amber){% elif r.rank == 2 %}var(--accent-silver){% elif r.rank == 3 %}var(--accent-bronze){% else %}var(--accent-blue){% endif %};">
                                {{ r.pphi_score }}
                            </span>
                        </div>

                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                {% if r.rank <= 3 %}
                                <span class="rank-medal {% if r.rank == 1 %}medal-gold{% elif r.rank == 2 %}medal-silver{% else %}medal-bronze{% endif %}">{{ r.rank }}</span>
                                {% else %}
                                <span class="text-xs font-semibold mono" style="color: var(--text-tertiary);">#{{ r.rank }}</span>
                                {% endif %}
                                {% if r.get('trend') == 'rising' %}<span class="trend-up text-xs font-semibold">â†‘</span>
                                {% elif r.get('trend') == 'falling' %}<span class="trend-down text-xs font-semibold">â†“</span>
                                {% elif r.get('trend') == 'stable' %}<span class="trend-stable text-xs">â†’</span>
                                {% else %}<span class="trend-new text-xs font-semibold">â˜…</span>{% endif %}
                                <span class="font-medium text-sm truncate">{{ r.pain_point }}</span>
                            </div>

                            <div class="flex flex-wrap gap-1 mb-1">
                                {% set all_models = r.get('gpu_tags', {}).get('models', []) %}
                                {% for m in all_models[:6] %}
                                <span class="gpu-tag">{{ m }}</span>
                                {% endfor %}
                                {% if all_models | length > 6 %}
                                <span class="gpu-tag" style="opacity: 0.6;">+{{ all_models | length - 6 }}</span>
                                {% endif %}
                                {% for mfr in r.get('gpu_tags', {}).get('manufacturers', [])[:3] %}
                                <span class="mfr-tag">{{ mfr }}</span>
                                {% endfor %}
                            </div>

                            <div class="flex items-center gap-2 text-xs" style="color: var(--text-tertiary);">
                                <span class="mono">{{ r.get('mentions', 0) }}</span> è®¨è®º
                                <span>Â·</span>
                                <span>{{ r.get('sources', []) | length }} ä¸ªæ¥æº</span>
                                <span>Â·</span>
                                <span>{{ all_models | length }} ä¸ªå‹å·</span>
                                {% if r.get('category') %}
                                <span>Â·</span>
                                <span>{{ r.get('category', '') }}</span>
                                {% endif %}
                            </div>

                            {% if r.get('hidden_need') %}
                            <div class="need-badge mt-2 inline-block">
                                <span class="text-xs" style="color: var(--accent-purple);">ğŸ’¡ {{ r.hidden_need }}</span>
                            </div>
                            {% endif %}
                        </div>

                        <span class="material-icons" style="color: var(--text-tertiary); font-size: 20px; flex-shrink: 0;">chevron_right</span>
                    </div>
                </a>
                {% endfor %}
            </div>

            {% if rankings | length > 10 %}
            <button id="expandBtn" onclick="toggleExpand()"
                    class="expand-btn w-full mt-4 py-3 rounded-lg text-sm font-medium flex items-center cursor-pointer"
                    style="color: var(--accent-blue); justify-content: center; gap: 8px;">
                <span class="material-icons text-base" id="expandIcon">expand_more</span>
                <span id="expandText">æŸ¥çœ‹å…¨éƒ¨ {{ rankings | length }} ä¸ªç—›ç‚¹</span>
            </button>
            {% endif %}

            {% else %}
            <div class="text-center" style="padding: 48px 0;">
                <span class="material-icons" style="font-size: 36px; color: var(--text-tertiary);">hourglass_empty</span>
                <p class="mt-2" style="color: var(--text-secondary);">ç­‰å¾…é¦–æ¬¡æ•°æ®é‡‡é›†...</p>
            </div>
            {% endif %}
        </div>
    </div>

    <footer class="site-footer">GPU-Insight Â· æ˜¾å¡ç”¨æˆ·ç—›ç‚¹æ™ºèƒ½åˆ†æç³»ç»Ÿ</footer>

    <!-- About Modal -->
    <div id="aboutModal" class="modal-overlay" onclick="if(event.target===this)this.classList.remove('active')">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="section-title" style="margin-bottom: 0;">
                    <span class="material-icons" style="color: var(--accent-blue);">info</span> å…³äº GPU-Insight
                </div>
                <span class="material-icons cursor-pointer" style="color: var(--text-secondary);"
                      onclick="document.getElementById('aboutModal').classList.remove('active')">close</span>
            </div>
            <div class="space-y-3 text-sm" style="color: var(--text-secondary); line-height: 1.6;">
                <p>GPU-Insight æ˜¯ä¸€ä¸ªæ˜¾å¡ç”¨æˆ·ç—›ç‚¹æ™ºèƒ½åˆ†æç³»ç»Ÿï¼Œæ¯ 4 å°æ—¶è‡ªåŠ¨é‡‡é›†å…¨çƒæ˜¾å¡è®ºå›è®¨è®ºï¼Œé€šè¿‡ AI æå–ç—›ç‚¹å¹¶æ¨å¯¼éšè—éœ€æ±‚ã€‚</p>
                <div class="p-3 rounded-lg" style="background: var(--bg-elevated); border: 1px solid var(--border-subtle);">
                    <p class="text-xs mb-1" style="color: var(--text-tertiary);">æ ¸å¿ƒæŒ‡æ ‡</p>
                    <p class="font-medium">PPHI (Pain Point Heat Index) â€” ç—›ç‚¹çƒ­åº¦æŒ‡æ•°</p>
                    <p class="text-xs mt-2" style="color: var(--text-tertiary);">ç»¼åˆè®¨è®ºé‡ã€æƒ…æ„Ÿå¼ºåº¦ã€ä¼ æ’­èŒƒå›´ç­‰ç»´åº¦åŠ æƒè®¡ç®—</p>
                </div>
                <div class="flex flex-wrap gap-2 text-xs">
                    <span class="p-3 rounded-lg" style="background: var(--bg-elevated); color: var(--text-tertiary); border: 1px solid var(--border-subtle); padding: 4px 8px;">Reddit / NGA / Bilibili / V2EX / TechPowerUp / MyDrivers</span>
                    <span class="p-3 rounded-lg" style="background: var(--bg-elevated); color: var(--text-tertiary); border: 1px solid var(--border-subtle); padding: 4px 8px;">AI: SiliconFlow GLM</span>
                    <span class="p-3 rounded-lg" style="background: var(--bg-elevated); color: var(--text-tertiary); border: 1px solid var(--border-subtle); padding: 4px 8px;">æ›´æ–°: æ¯ 4 å°æ—¶</span>
                </div>
            </div>
        </div>
    </div>

    <script>
    function toggleExpand() {
        const extras = document.querySelectorAll('.ranking-extra');
        const icon = document.getElementById('expandIcon');
        const text = document.getElementById('expandText');
        const isExpanded = extras[0]?.classList.contains('show');
        extras.forEach((el, i) => {
            if (isExpanded) {
                el.classList.remove('show');
            } else {
                el.classList.add('show');
                el.style.animation = `fadeInUp 0.3s ease forwards`;
                el.style.animationDelay = `${i * 0.03}s`;
            }
        });
        icon.textContent = isExpanded ? 'expand_more' : 'expand_less';
        text.textContent = isExpanded ? 'æŸ¥çœ‹å…¨éƒ¨ {{ rankings | length }} ä¸ªç—›ç‚¹' : 'æ”¶èµ·åˆ—è¡¨';
    }
    </script>
</body>
</html>
