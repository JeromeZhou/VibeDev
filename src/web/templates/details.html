<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>痛点详情 — GPU-Insight</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Noto+Sans+SC:wght@400;500;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-base:     #0b0d14;
            --bg-surface:  #111318;
            --bg-elevated: #161922;
            --bg-hover:    #1c1f2b;
            --border-subtle:  rgba(255,255,255,0.06);
            --border-default: rgba(255,255,255,0.09);
            --border-strong:  rgba(255,255,255,0.14);
            --text-primary:   #ececf1;
            --text-secondary: #8b8fa3;
            --text-tertiary:  #565869;
            --accent-blue:    #5b8def;
            --accent-purple:  #9d8abf;
            --accent-green:   #5ec49e;
            --accent-red:     #e5534b;
            --accent-amber:   #d4a04a;
            --accent-silver:  #9ba3b0;
            --accent-bronze:  #b08952;
        }

        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background: var(--bg-base);
            color: var(--text-primary);
            font-weight: 400;
        }
        .mono { font-family: 'JetBrains Mono', monospace; }

        .card {
            background: var(--bg-surface);
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .gpu-tag {
            background: rgba(139,92,246,0.10);
            color: #a78bcc;
            padding: 2px 10px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            border: 1px solid rgba(139,92,246,0.15);
        }
        .mfr-tag {
            background: rgba(80,200,150,0.08);
            color: #7bc4a5;
            padding: 2px 10px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            border: 1px solid rgba(80,200,150,0.12);
        }
        .brand-tag {
            background: rgba(220,150,60,0.08);
            color: #c4a06b;
            padding: 2px 10px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            border: 1px solid rgba(220,150,60,0.12);
        }

        .mesh-bg {
            background:
                radial-gradient(ellipse at 15% 50%, rgba(37,99,235,0.04) 0%, transparent 50%),
                radial-gradient(ellipse at 85% 15%, rgba(124,58,237,0.03) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 85%, rgba(5,150,105,0.03) 0%, transparent 50%);
        }

        .need-card {
            background: var(--bg-surface);
            border: 1px solid rgba(139,92,246,0.15);
        }

        .trend-pill {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 2px 8px; border-radius: 20px; font-size: 12px; font-weight: 600;
        }
        .trend-rising  { background: rgba(94,196,158,0.10); color: var(--accent-green); border: 1px solid rgba(94,196,158,0.18); }
        .trend-falling { background: rgba(229,83,75,0.10); color: var(--accent-red); border: 1px solid rgba(229,83,75,0.18); }
        .trend-new     { background: rgba(91,141,239,0.10); color: var(--accent-blue); border: 1px solid rgba(91,141,239,0.18); }
        .trend-stable  { background: rgba(86,88,105,0.12); color: var(--text-tertiary); border: 1px solid rgba(86,88,105,0.20); }

        /* PPHI detail ring — 44px, no glow */
        .pphi-detail-ring {
            width: 44px; height: 44px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid var(--border-strong);
            background: transparent;
        }
        .pphi-detail-ring.rank-1 { border-color: var(--accent-amber); }
        .pphi-detail-ring.rank-2 { border-color: var(--accent-silver); }
        .pphi-detail-ring.rank-3 { border-color: var(--accent-bronze); }
        .pphi-detail-ring.rank-default { border-color: var(--accent-blue); }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in { animation: fadeInUp 0.3s ease forwards; opacity: 0; }

        .nav-link {
            color: var(--text-secondary);
            font-size: 14px;
            display: flex; align-items: center; gap: 4px;
            transition: color 0.15s ease;
        }
        .nav-link:hover { color: var(--text-primary); }
    </style>
</head>
<body class="min-h-screen mesh-bg">
    <header class="py-4 px-6 border-b" style="border-color: var(--border-subtle);">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background: var(--accent-blue);">
                    <span class="material-icons text-white text-base">article</span>
                </div>
                <div>
                    <h1 class="text-lg font-semibold" style="color: var(--text-primary);">痛点详情</h1>
                    <p class="text-xs" style="color: var(--text-tertiary);">GPU-Insight · 深度分析</p>
                </div>
            </div>
            <div class="flex gap-4 items-center">
                <a href="/" class="nav-link">
                    <span class="material-icons text-base">dashboard</span> 仪表盘
                </a>
                <a href="/trends" class="nav-link">
                    <span class="material-icons text-base">trending_up</span> 趋势
                </a>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto py-6 px-4">
        {% if pain_point %}
        <!-- 痛点概览 -->
        <div class="card p-6 mb-4 animate-in" style="animation-delay: 0.05s">
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-3 mb-3 flex-wrap">
                        <span class="text-2xl font-semibold mono
                            {% if pain_point.get('rank') == 1 %}" style="color: var(--accent-amber);
                            {% elif pain_point.get('rank') == 2 %}" style="color: var(--accent-silver);
                            {% elif pain_point.get('rank') == 3 %}" style="color: var(--accent-bronze);
                            {% else %}" style="color: var(--accent-blue);{% endif %}">#{{ pain_point.get('rank', '?') }}</span>
                        <h2 class="text-lg font-semibold" style="color: var(--text-primary);">{{ pain_point.pain_point }}</h2>
                        <span class="trend-pill
                            {% if pain_point.get('trend') == 'rising' %}trend-rising
                            {% elif pain_point.get('trend') == 'falling' %}trend-falling
                            {% elif pain_point.get('trend') == 'new' %}trend-new
                            {% else %}trend-stable{% endif %}">
                            {% if pain_point.get('trend') == 'rising' %}↑ 上升
                            {% elif pain_point.get('trend') == 'falling' %}↓ 下降
                            {% elif pain_point.get('trend') == 'new' %}★ 新增
                            {% else %}→ 稳定{% endif %}
                        </span>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <span class="text-xs px-3 py-1 rounded-md flex items-center gap-1" style="background: var(--bg-elevated); color: var(--text-secondary); border: 1px solid var(--border-subtle);">
                            <span class="material-icons text-xs">category</span> {{ pain_point.get('category', '-') }}
                        </span>
                        <span class="text-xs px-3 py-1 rounded-md flex items-center gap-1" style="background: var(--bg-elevated); color: var(--text-secondary); border: 1px solid var(--border-subtle);">
                            <span class="material-icons text-xs">people</span> {{ pain_point.get('affected_users', '-') }}
                        </span>
                        <span class="text-xs px-3 py-1 rounded-md flex items-center gap-1" style="background: var(--bg-elevated); color: var(--text-secondary); border: 1px solid var(--border-subtle);">
                            <span class="material-icons text-xs">forum</span> {{ pain_point.get('mentions', 0) }} 讨论
                        </span>
                        <span class="text-xs px-3 py-1 rounded-md" style="background: var(--bg-elevated); color: var(--text-secondary); border: 1px solid var(--border-subtle);">
                            {{ pain_point.get('sources', []) | join(', ') }}
                        </span>
                    </div>
                </div>
                <div class="text-center shrink-0">
                    <div class="pphi-detail-ring
                        {% if pain_point.get('rank') == 1 %}rank-1
                        {% elif pain_point.get('rank') == 2 %}rank-2
                        {% elif pain_point.get('rank') == 3 %}rank-3
                        {% else %}rank-default{% endif %}">
                        <p class="text-base font-semibold mono
                            {% if pain_point.get('rank') == 1 %}" style="color: var(--accent-amber);
                            {% elif pain_point.get('rank') == 2 %}" style="color: var(--accent-silver);
                            {% elif pain_point.get('rank') == 3 %}" style="color: var(--accent-bronze);
                            {% else %}" style="color: var(--accent-blue);{% endif %}">{{ pain_point.pphi_score }}</p>
                    </div>
                    <p class="text-xs mt-1 mono" style="color: var(--text-tertiary);">PPHI</p>
                </div>
            </div>

            {% if pain_point.get('evidence') %}
            <div class="mt-4 p-4 rounded-lg" style="background: var(--bg-elevated); border-left: 2px solid var(--accent-blue);">
                <p class="text-xs mb-1 flex items-center gap-1" style="color: var(--text-tertiary);">
                    <span class="material-icons text-xs">format_quote</span> 证据摘要
                </p>
                <p class="text-sm leading-relaxed" style="color: var(--text-secondary);">{{ pain_point.evidence }}</p>
            </div>
            {% endif %}
        </div>

        <!-- AI 推理需求 -->
        {% if pain_point.get('hidden_need') %}
        <div class="card need-card p-6 mb-4 animate-in" style="animation-delay: 0.1s">
            <h3 class="font-medium mb-3 flex items-center gap-2" style="color: var(--text-primary);">
                <span class="material-icons" style="color: var(--accent-purple);">psychology</span> AI 推理需求
                {% if pain_point.get('confidence', 0) < 0.6 %}
                <span class="text-xs px-2 py-0.5 rounded-full ml-auto" style="background: rgba(212,160,74,0.10); color: var(--accent-amber); border: 1px solid rgba(212,160,74,0.18);">待验证</span>
                {% endif %}
            </h3>
            <p class="text-base leading-relaxed" style="color: var(--accent-purple);">{{ pain_point.hidden_need }}</p>
            <div class="mt-3 flex items-center gap-4">
                <span class="text-xs mono" style="color: var(--text-tertiary);">置信度: {{ (pain_point.get('confidence', 0) * 100) | int }}%</span>
                <div class="flex-1 h-1 rounded-full" style="background: var(--bg-elevated);">
                    <div class="h-1 rounded-full
                        {% if pain_point.get('confidence', 0) >= 0.8 %}" style="background: var(--accent-green); width: {{ (pain_point.get('confidence', 0) * 100) | int }}%
                        {% elif pain_point.get('confidence', 0) >= 0.6 %}" style="background: var(--accent-purple); width: {{ (pain_point.get('confidence', 0) * 100) | int }}%
                        {% else %}" style="background: var(--accent-amber); width: {{ (pain_point.get('confidence', 0) * 100) | int }}%{% endif %}"></div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- 关联原帖 -->
        {% if posts %}
        <div class="card p-6 mb-4 animate-in" style="animation-delay: 0.15s">
            <h3 class="font-medium mb-4 flex items-center gap-2" style="color: var(--text-primary);">
                <span class="material-icons" style="color: var(--accent-blue);">forum</span> 关联讨论
                <span class="text-xs mono ml-auto" style="color: var(--text-tertiary);">{{ posts | length }} 帖</span>
            </h3>
            <div class="space-y-2">
                {% for post in posts %}
                <a href="{{ post.url }}" target="_blank" rel="noopener"
                   class="block p-3 rounded-lg transition-all duration-200 group"
                   style="background: var(--bg-elevated); border: 1px solid var(--border-subtle);"
                   onmouseenter="this.style.borderColor='var(--border-default)'"
                   onmouseleave="this.style.borderColor='var(--border-subtle)'">
                    <div class="flex items-start gap-3">
                        <div class="w-7 h-7 rounded-md flex items-center justify-center shrink-0 mt-0.5
                            {% if post.source == 'reddit' %}" style="background: rgba(229,83,75,0.10); color: var(--accent-red);
                            {% elif post.source == 'nga' %}" style="background: rgba(94,196,158,0.10); color: var(--accent-green);
                            {% elif post.source == 'videocardz' %}" style="background: rgba(157,138,191,0.10); color: var(--accent-purple);
                            {% else %}" style="background: rgba(91,141,239,0.10); color: var(--accent-blue);{% endif %}">
                            <span class="material-icons text-sm">
                                {% if post.source == 'reddit' %}reddit
                                {% elif post.source == 'nga' %}language
                                {% elif post.source == 'videocardz' %}newspaper
                                {% else %}article{% endif %}
                            </span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium truncate" style="color: var(--text-primary);">{{ post.title }}</p>
                            <div class="flex items-center gap-3 mt-1 text-xs" style="color: var(--text-tertiary);">
                                <span class="uppercase font-medium
                                    {% if post.source == 'reddit' %}" style="color: var(--accent-red);
                                    {% elif post.source == 'nga' %}" style="color: var(--accent-green);
                                    {% elif post.source == 'videocardz' %}" style="color: var(--accent-purple);
                                    {% else %}" style="color: var(--accent-blue);{% endif %}">{{ post.source }}</span>
                                {% if post.replies %}
                                <span class="flex items-center gap-0.5">
                                    <span class="material-icons text-xs">chat_bubble_outline</span> {{ post.replies }}
                                </span>
                                {% endif %}
                                {% if post.likes %}
                                <span class="flex items-center gap-0.5">
                                    <span class="material-icons text-xs">thumb_up_off_alt</span> {{ post.likes }}
                                </span>
                                {% endif %}
                                {% if post.timestamp %}
                                <span>{{ post.timestamp[:10] }}</span>
                                {% endif %}
                            </div>
                        </div>
                        <span class="material-icons text-sm shrink-0 mt-1" style="color: var(--text-tertiary);">open_in_new</span>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% elif pain_point.get('source_urls') %}
        <div class="card p-6 mb-4 animate-in" style="animation-delay: 0.15s">
            <h3 class="font-medium mb-3 flex items-center gap-2" style="color: var(--text-primary);">
                <span class="material-icons" style="color: var(--accent-blue);">link</span> 原帖追溯
            </h3>
            <div class="space-y-2">
                {% for url in pain_point.source_urls %}
                <a href="{{ url }}" target="_blank" rel="noopener"
                   class="flex items-center gap-2 p-3 rounded-lg transition group"
                   style="background: var(--bg-elevated); border: 1px solid var(--border-subtle);"
                   onmouseenter="this.style.borderColor='var(--border-default)'"
                   onmouseleave="this.style.borderColor='var(--border-subtle)'">
                    <span class="material-icons text-sm" style="color: var(--text-tertiary);">open_in_new</span>
                    <span class="text-sm truncate" style="color: var(--accent-blue);">{{ url }}</span>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- GPU 产品标签 -->
        {% set gpu = pain_point.get('gpu_tags', {}) %}
        {% if gpu.get('brands') or gpu.get('models') or gpu.get('manufacturers') %}
        <div class="card p-6 mb-4 animate-in" style="animation-delay: 0.2s">
            <h3 class="font-medium mb-4 flex items-center gap-2" style="color: var(--text-primary);">
                <span class="material-icons" style="color: var(--accent-green);">memory</span> GPU 产品关联
            </h3>
            <div class="flex flex-wrap gap-x-8 gap-y-4">
                {% if gpu.get('brands') %}
                <div>
                    <p class="text-xs mb-2 uppercase tracking-wider" style="color: var(--text-tertiary);">芯片品牌</p>
                    <div class="flex flex-wrap gap-2">
                        {% for b in gpu.brands %}<span class="brand-tag">{{ b }}</span>{% endfor %}
                    </div>
                </div>
                {% endif %}
                {% if gpu.get('models') %}
                <div>
                    <p class="text-xs mb-2 uppercase tracking-wider" style="color: var(--text-tertiary);">具体型号</p>
                    <div class="flex flex-wrap gap-2">
                        {% for m in gpu.models %}<span class="gpu-tag">{{ m }}</span>{% endfor %}
                    </div>
                </div>
                {% endif %}
                {% if gpu.get('manufacturers') %}
                <div>
                    <p class="text-xs mb-2 uppercase tracking-wider" style="color: var(--text-tertiary);">板卡厂商</p>
                    <div class="flex flex-wrap gap-2">
                        {% for mfr in gpu.manufacturers %}<span class="mfr-tag">{{ mfr }}</span>{% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        {% else %}
        <!-- 空状态 -->
        <div class="card p-12 text-center animate-in" style="animation-delay: 0.05s">
            <span class="material-icons text-5xl mb-4" style="color: var(--text-tertiary);">search_off</span>
            <p class="text-lg mb-2" style="color: var(--text-secondary);">未找到该痛点</p>
            <p class="text-sm mb-4" style="color: var(--text-tertiary);">可能已被合并或排名变动</p>
            <a href="/" class="inline-flex items-center gap-1 px-4 py-2 rounded-lg text-sm transition" style="background: var(--accent-blue); color: white;">
                <span class="material-icons text-sm">arrow_back</span> 返回仪表盘
            </a>
        </div>
        {% endif %}
    </main>

    <footer class="text-center text-xs py-6 mt-8" style="color: var(--text-tertiary); border-top: 1px solid var(--border-subtle);">
        GPU-Insight v1.0 · 显卡用户痛点智能分析系统
    </footer>
</body>
</html>
